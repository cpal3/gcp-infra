# Terraform Bootstrap Workflow
# Manages the lifecycle of the Seed Project and core IAM.

name: "Terraform Bootstrap"

concurrency:
  group: terraform-deployment
  cancel-in-progress: false

on:
  push:
    branches:
      - main
    paths:
      - 'bootstrap/**'
      - 'modules/**'
  pull_request:
    branches:
      - main
    paths:
      - 'bootstrap/**'
      - 'modules/**'

jobs:
  bootstrap:
    name: "Bootstrap"
    permissions:
      contents: 'read'
      id-token: 'write'
    uses: ./.github/workflows/terraform-module.yaml
    with:
      directory: 'bootstrap'
      environment: 'bootstrap'
      service_account: 'terraform-runner@ingr-seed-project.iam.gserviceaccount.com'
    secrets:
      ORG_ID: ${{ secrets.TF_VAR_ORG_ID }}
      BILLING_ACCOUNT: ${{ secrets.TF_VAR_BILLING_ACCOUNT }}
      PROJECT_NAME: ${{ secrets.TF_VAR_PROJECT_NAME }}
      REGION: ${{ secrets.TF_VAR_REGION }}
      GITHUB_REPO: ${{ secrets.TF_VAR_GITHUB_REPO }}
